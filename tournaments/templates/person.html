<!--
Coppyright (c) 2017 Francisco Javier Revilla Linares to present.
All rights reserved.
-->
{% extends "base.html" %}
{% load staticfiles %}
{% load i18n %}
{% load handy_tags %}


{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/tabs.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'css/rotating-card.css' %}"/>
{% endblock %}


{% block content %}
<div class="container_12">

    <!-- Título Página -->
    <div class="root roll">
        <a href="/" class="inactive">{% trans "Home" %}</a>
        <i class="fa fa-chevron-right"></i><a href="" class="inactive">{% trans "Player" %}</a>
        <i class="fa fa-chevron-right"></i><a href="" class="active">{% for p in player %} {{p.first_name}} {{p.last_name}}{% endfor %}</a>
    </div>

    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 card_info">
        <input id="tab1" type="radio" name="tabs" style="padding-left: 0px; float: left" checked>
        <label for="tab1">{% trans "Activity" %}</label>
        <input id="tab3" type="radio" name="tabs" style="padding-left: 0px; float: left">
        <label for="tab3">{% trans "Teams" %}</label>
        <input id="tab2" type="radio" name="tabs" style="padding-left: 0px; float: left">
        <label for="tab2">{% trans "Ranking" %}</label>

        <!-- tab activity -->
        <section id="content1">
            <div class="card">
                <hr class="separador_torneo" style="margin-bottom: 0px">
                <h3 class="form_title" style="font-weight: 600; color:#000; text-align:center">
                    {% trans "Stats" %}
                </h3>
                <hr class="separador_torneo" style="margin-top: 0px">
                <table class="table" style="text-align: center">
                    <thead>
                    <tr>
                        <th class="quinto">{% trans "Tournaments" %}</th>
                        <th class="quinto">{% trans "Matches" %}</th>
                        <th class="quinto">{% trans "Won" %}</th>
                        <th class="quinto">{% trans "Lost" %}</th>
                        <th class="quinto">{% trans "Effectiveness" %}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <svg viewBox="0 0 36 36" class="circular-chart red quinto_circle">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle" stroke-dasharray="100, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage">{{total_tournaments}}</text>
                            </svg>
                        </td>
                        <td>
                            <svg viewBox="0 0 36 36" class="circular-chart red quinto_circle">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle" stroke-dasharray="100, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage">{{total_games}}</text>
                            </svg>
                        </td>
                        <td>
                            <svg viewBox="0 0 36 36" class="circular-chart red quinto_circle">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle" stroke-dasharray="100, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage">{{total_wins}}</text>
                            </svg>
                        </td>
                        <td>
                            <svg viewBox="0 0 36 36" class="circular-chart red quinto_circle">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle" stroke-dasharray="100, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage">{{total_lost}}</text>
                            </svg>
                        </td>
                        <td>
                            <svg viewBox="0 0 36 36" class="circular-chart red quinto_circle">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle" stroke-dasharray="{{ratio}}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <text x="18" y="20.35" class="percentage">{{ratio}}%</text>
                            </svg>
                        </td>
                    </tr>
                    </tbody>
                </table>


                <!--Competitions-->

                <hr class="separador_torneo" style="margin-bottom: 0px">
                <h3 class="form_title" style="font-weight: 600; color:#000; text-align:center">
                    {% trans "Competitions" %}
                </h3>
                <hr class="separador_torneo" style="margin-top: 0px">

                {% for key, values in sorted_games.items %}
                <table class="col-sm-12 table table-striped table-hover">
                    <tbody>

                    <tr>
                        <td class="col-xs-12" style="float: left; padding-top: 10px;">
                            <!-- Logo Serie -->
                            <div class="col-xs-1 col-sm-1 col-md-1 hidden-sm-down "
                                 style="float: left; padding-left: 0px">
                                <div style="float: left">
                                    <img class="category_turnierliste"
                                         src="{% static key.serie_url %}" alt="GPS-500">
                                </div>
                            </div>

                            <!-- Categoría -->
                            <button type="button" class="col-xs-1 col-sm-1 col-bg-1 btn cat"
                                    style="margin: 0 0 0 10; border-color: #d7d7d7">
                                {{key.division}}
                            </button>


                            <!-- Serie, Ciudad y Fecha -->
                            <div class="col-xs-4 col-sm-5 text_tournament_title" style="float: left; margin: 0 0 0 20">
                                <a href="{% url 'tournament' key.id %}" class="text_tournament_title"
                                   style="width: 50%; text-transform: uppercase; font-weight: 600;">
                                    {{key.padel_serie}} // {{key.city}}</a><br>
                                {% if key.date %}
                                <a class="text_tournament_title"
                                   style="width: 100%; color:black">{{key.name}}</a><br>
                                <a class="text_tournament_title"
                                   style="width: 100%; color:black">{{key.date}}</a>

                                {% else %}
                                <a class="text_tournament_title"
                                   style="width: 100%; font-weight: bold; color:black"></a>
                                {% endif %}
                            </div>

                            <!-- Club -->
                            <div class="col-xs-1 col-sm-1 " style="float: left; margin: 0 0 0 -20">

                                <div class="user-tournamentlist" style="background-color: none">
                                    <img class="img" style="max-width: 100%" src="{{ key.club.logo.url }}">
                                </div>
                            </div>

                            <div class="col-xs-4 col-sm-4" style="float: left; width: 30%">
                                <a class="text_club"
                                   style="padding-left:10px; text-transform: uppercase; color:black">
                                    {% if key.club %}
                                    {{key.club}}
                                    {% else %}
                                    Unknown
                                    {% endif %}
                                </a>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <!--Games-->

                <table class="col-sm-12 table table-hover">
                    <tbody>
                    {% for g in values %}
                    <tr>
                        <td class="col-xs-12" style="float: left; padding-top: 10px;">
                            <!-- Serie, Ciudad y Fecha -->
                            <div class="col-xs-4 col-sm-5 text_tournament_title" style="float: left; margin: 0">
                                <a href="{% url 'tournament' g.id %}" class="text_tournament_title"
                                   style="width: 100%; color:black; font-weight: 400;">{{g.tournament.name}}</a><br>
                                <a class="text_tournament_title"
                                   style="width: 50%; color:black; text-transform: uppercase; ">
                                    {{g.tournament.padel_serie}} // {{g.tournament.city}}</a><br>
                                <a class="text_tournament_title"
                                   style="width: 100%; color:black">{{g.tournament.date}}</a>
                            </div>
                            <div class="col-xs-2 col-sm-2 text_tournament_title" style="float: left">
                                <a class="text_tournament_title" style="width: 100%; color:black">
                                    {% if "PoolA" in g.phase.round %}
                                    {% trans "Group" %} A
                                    {% elif "PoolB" in g.phase.round %}
                                    {% trans "Group" %} B
                                    {% elif "PoolC" in g.phase.round %}
                                    {% trans "Group" %} C
                                    {% elif "PoolD" in g.phase.round %}
                                    {% trans "Group" %} D
                                    {% elif "PoolE" in g.phase.round %}
                                    {% trans "Group" %} E
                                    {% elif "PoolF" in g.phase.round %}
                                    {% trans "Group" %} F
                                    {% elif "PoolY" in g.phase.round %}
                                    {% trans "Repechage" %} 2
                                    {% elif "PoolZ" in g.phase.round %}
                                    {% trans "Repechage" %} 1
                                    {% elif "KO16" in g.phase.round %}
                                    {% trans "Round of 32" %}
                                    {% elif "KO8" in g.phase.round %}
                                    {% trans "Round of 16" %}
                                    {% elif "KO4" in g.phase.round %}
                                    {% trans "Quarterfinals" %}
                                    {% elif "KO2" in g.phase.round %}
                                    {% trans "Semifinal" %}
                                    {% elif "KO1" in g.phase.round %}
                                    {% trans "Final" %}
                                    {% elif "POS3" in g.phase.round %}
                                    {% trans "Match for the 3rd Place" %}
                                    {% endif %}
                                </a><br>
                            </div>
                            <div class="col-xs-4 col-sm-4 text_tournament_title" style="float: left; padding: 0">
                                <a class="text_tournament_title" style="width: 100%; color:black">{{g.local}}</a><br>
                                <a class="text_tournament_title" style="width: 100%; color:black">{{g.visitor}}</a><br>
                            </div>
                            <div class="col-xs-1 col-sm-1 text_tournament_title" style="float: left; padding: 0">
                                <a class="text_tournament_title" style="width: 100%; color:black">{{g.result_padel.local1}}
                                    {% if g.result_padel.local2 >= 0 %}
                                    {{g.result_padel.local2}}
                                    {% endif %}
                                    {% if g.result_padel.local3 >= 0 %}
                                    {{g.result_padel.local3}}
                                    {% endif %}
                                </a><br>
                                <a class="text_tournament_title" style="width: 100%; color:black">{{g.result_padel.visitor1}}
                                    {% if g.result_padel.visitor2 >= 0 %}
                                    {{g.result_padel.visitor2}}
                                    {% endif %}
                                    {% if g.result_padel.visitor3 >= 0 %}
                                    {{g.result_padel.visitor3}}
                                    {% endif %}
                                </a><br>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
                {% endfor %}

            </div>
        </section>

        <!--Partners-->
        <section id="content3">
            <div class="card">
                <hr class="separador_torneo" style="margin-bottom: 0px">
                <h3 class="form_title" style="font-weight: 600; color:#000; text-align:center">
                    {% trans "Teams" %}
                </h3>
                <hr class="separador_torneo" style="margin-top: 0px">
                <table class="col-sm-12 table table-striped table-hover">
                    <tbody>
                    {% for t in teams %}
                    <tr>
                        <td>

                            <a class="col-xs-2 col-sm-2 dos text_tournament_title" style="font-weight: 600"
                                                                                   href="{% url 'team' t.id %}">{{t}}</a>
                       </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!--Ranking-->
        <section id="content2">
            <div class="card">
                <hr class="separador_torneo" style="margin-bottom: 0px">
                <h3 class="form_title" style="font-weight: 600; color:#DC4C46; text-align:center">
                    {% trans "Ranking" %}
                </h3>
                <hr class="separador_torneo" style="margin-top: 0px">

                <!-- ranking graphic -->
                <canvas id="ranking_graphic" width="300" height="200"></canvas>

                <!-- ranking graphic -->
                <canvas id="ranking_graphic_2" width="300" height="200"></canvas>

                <!-- ranking table -->
                <table id="" class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th data-field="rank">
                                <div class="th-inner ">{% trans "Date" %}</div>
                                <div class="fht-cell"></div>
                            </th>
                            {% for header in table_headers %}
                            <th data-field="{{header}}">
                                <div class="th-inner sortable both">{% trans header %}</div>
                                <div class="fht-cell"></div>
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in ranking %}
                        <tr>
                            {% for cell in row %}
                                <td>{{cell}}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                {% for row in ranking %}
                    {% for cell in row %}
                        {{cell}}
                    {% endfor %}
                <br>
                {% endfor %}
            </div>
        </section>
    </div>

</div>
{% endblock %}

{% block js %}
<script src="{% static 'js/Chart.bundle.min.js' %}"></script>
<script src="{% static 'js/ranking-chart.js' %}"></script>

<script>
    // general settings for chartsjs
    Chart.defaults.global.elements.point.pointStyle='line';

    // convert data to JS variable
    var grPoints = {{gr_points}};
    var grPositions = {{gr_positions}};
    var grLabels = [];

    {% for x in gr_labels %}
        dstr = '{{x | jsdate}}'
        grLabels.push(dstr);
    {% endfor %}

    var test = {{points}};
    console.log(test.length);
    for (x of test) {
      console.log('iteracion')
      console.log(x);
    }

    var ctx1 = document.getElementById('ranking_graphic').getContext('2d');

    var chart1 = createPersonRanking(ctx1, grPositions, grPoints);

    var ctx2 = document.getElementById('ranking_graphic_2').getContext('2d');
    var chart2 = createPersonRanking(ctx2, grPositions, grPoints);
</script>
{% endblock %}
